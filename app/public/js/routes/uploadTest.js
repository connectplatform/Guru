// Generated by CoffeeScript 1.3.3
(function() {

  define(["load/server"], function(server) {
    return function(_, templ) {
      return server.ready(function() {
        return server.awsUpload(function(err, fields) {
          console.log('server provided fields: ', fields);
          $('#content').html(templ({
            s3: fields
          }));
          return $("#submit").click(function(evt) {
            var complete, data, notice;
            evt.preventDefault();
            data = new FormData();
            data.append('key', fields.key);
            data.append('Content-Type', $('#uploadFile')[0].files[0].type);
            data.append('AWSAccessKeyId', fields.awsAccessKey);
            data.append('policy', fields.policy);
            data.append('signature', fields.signature);
            data.append('file', $('#uploadFile')[0].files[0]);
            notice = function() {
              return alert('file upload succeeded');
            };
            complete = function(obj) {
              console.log('request complete');
              console.log('status: ', obj.statusText);
              return console.log('aws response: ', obj.responseText);
            };
            $.ajax({
              url: "https://" + fields.bucket + ".s3.amazonaws.com/",
              data: data,
              processData: false,
              contentType: false,
              type: 'POST',
              success: notice,
              complete: complete
            });
            return false;
          });
        });
      });
    };
  });

}).call(this);
