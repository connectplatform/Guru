// Generated by CoffeeScript 1.3.3
(function() {

  define(["app/server", "app/notify", "routes/sidebar", "templates/sidebar", "app/util"], function(server, notify, sidebar, sbTemp, util) {
    return function(args, templ) {
      if (!server.cookie('session')) {
        return window.location.hash = '/';
      }
      return server.ready(function() {
        return server.findUser({}, function(err, users) {
          if (err) {
            console.log("err retrieving users: " + err);
          }
          sidebar({}, sbTemp);
          $('#content').html(templ({
            users: users
          }));
          return $('#addUser').click(function(evt) {
            evt.preventDefault();
            $('#user-modal').modal();
            return $('#user-modal').submit(function() {
              var fields;
              fields = {
                firstName: $('#user-form #firstName').val(),
                lastName: $('#user-form #lastName').val(),
                email: $('#user-form #email').val(),
                role: $('#user-form #role').val(),
                websites: $('#user-form #websites').val(),
                departments: $('#user-form #departments').val()
              };
              return server.saveUser(fields, function(err, data) {
                if (err != null) {
                  return notify.error("Error saving user: " + err);
                }
                return $('#user-modal').hide();
              });
            });
          });
        });
      });
    };
  });

}).call(this);
