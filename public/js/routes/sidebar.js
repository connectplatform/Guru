// Generated by CoffeeScript 1.3.3
(function() {

  define(["app/server", "app/notify", "app/pulsar", 'templates/badge'], function(server, notify, pulsar, badge) {
    return function(args, templ) {
      var updateUnanswered, updates;
      $('#sidebar').html(templ());
      updates = pulsar.channel('notify:operators');
      updateUnanswered = function(num) {
        var content;
        console.log("" + num + " unanswered");
        content = num > 0 ? badge({
          num: num
        }) : '';
        return $(".notifyUnanswered").html(content);
      };
      return server.ready(function() {
        return server.getMyRole(function(err, role) {
          if (role !== 'Operator' && role !== 'Supervisor' && role !== 'Admin') {
            return window.location.hash = '#/logout';
          } else {
            console.log("yep we're good");
            server.getChatStats(function(err, stats) {
              return updateUnanswered(stats.unanswered.length);
            });
            updates.on('unansweredCount', updateUnanswered);
            return $(window).bind('hashchange', function() {
              return updates.removeAllListeners('unansweredCount');
            });
          }
        });
      });
    };
  });

}).call(this);
